# Парсер для компании ООО "Реестр-РН"
![parserlib](https://img.shields.io/static/v1?label=parserlib&message=phpQuery&color=brightgreen) 

Парсер новостей с сайтов разработан для компании "Реестр РН".

# Инструкция

## Добавление нового сайта

Чтобы добавить новый сайт нужно:

1. В файле code/index.php добавить ссылку на сайт в массив $urls

        'домен сайта' => ['url' => 'полная ссылка на страницу с новостями', 'type' => 'html', 'curl' => true]

        // пример
        'aoreestr.ru' => ['url' => 'https://aoreestr.ru/press','type' => 'html', 'curl' => true]
    
2. Добавить теги для парсинга в файле code/parsers/SiteParser.php

    > внизу файла добавить блок elseif

        elseif($site_name == 'домен сайта'){
            $tags = [
                'article' => 'тег всего блока с новосостями > путь по тегам до блока с одной новостью',
                'title' => 'путь до заголовка внутри блока новости',
                'desc' => 'путь до описания внутри блока новости или null',
                'link' => 'путь до ссылки (тега a) внутри блока новости',
                'time' => 'путь до даты внутри блока новости'];
        }
    > Пример можно посмотреть в файле SiteParser.php

    > Подробная инструкция по настроики тегов парсера есть [в документации к библиотеке phpQuery](https://code.google.com/archive/p/phpquery/)

Делее остаётся проверить корректность отображения новостей и сайт добавлен.

---

## Запуск парсера

> Перед запуском парсера необходимо настроить базы данных!

Для запуска парсера должен быть установлен php интерпретатор.

В случае, если парсер расположен на web-сервере (локальном или удалённом), то нужно перейти по адресу /code/index.php и парсинг автоматически запустится.

Если парсер нужно запустить с помощью cmd, то пропишите следующую команду:

    php7 <путь до файла index.php>

> php7 - путь до интерпретатора php

---
## Настройка Базы Данных

В данном проекте используется PostgreSQL

Настройка подключения к БД осуществляется в файле code\api\config\database.php

    $host = "127.0.0.1"; // если локальный оставляем, если удаленный пишем нужный ip
    $db_name = "parser"; // название БД
    $username; // имя пользователья
    $password; // пароль пользователя

Настрока таблицы, куда записываются спарсенные новости, осуществляется в файле code\api\objects\news.php

> Для тестовых запусков рекомендуется использовать тестовую таблицу, так как новость может быть записана в таблицу только один раз.

### Настройка рассылки

Отправка сообщений на почту происходит от имени аккаунта reestr.parser@yandex.ru

Настройка адресов для отправки рассылки осуществляется в файле code\mail.php путём добавления строки с адресатом в блоке "кому"

    $mail->addAddress('<mail@domen.ru>', '<Петров Иван Петрович>');

# Лицензия

Copyright (c) Александр Извеков. Все права защищены.

Лицензирован по Apache License.